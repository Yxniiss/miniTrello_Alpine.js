<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Exercice ToDoList Alpine.js</title>
  <script src="https://unpkg.com/@alpinejs/persist@3.10.3/dist/cdn.min.js" defer></script>
  <script src="https://unpkg.com/alpinejs" defer></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <div x-data="todoApp()">
    <form x-on:submit.prevent="addNewTodo">
      <h1>Ma ToDoList avec Alpine.js</h1>
      <input type="text" class="todoInput" placeholder="Nouvelle tâche" x-model="newTodoTitle" required>
      <input type="text" class="todoInput" placeholder="Description" x-model="newTodoDesc" required>
      <button type="submit">Ajouter</button>
    </form>

    <div class="filter-bar">
      <label for="filter">Filtrer par statut :</label>
      <select id="filter" x-model="filtreStatus">
        <option value="Toutes">Toutes</option>
        <option value="À faire">À faire</option>
        <option value="En cours">En cours</option>
        <option value="Terminé">Terminé</option>
      </select>
    </div>

    <div class="trello">
      <div x-show="filtreStatus === 'Toutes' || filtreStatus === 'À faire'">
        <h2>À faire (<span x-text="filteredTodos('À faire').length"></span> tâches)</h2>
        <template x-for="todo in filteredTodos('À faire')" :key="todo.id">
          <div class="TodoDO">
            <template x-if="!todo.isEditing">
              <div>
                <div x-text="todo.title"></div>
                <div x-text="'Description : ' + todo.description"></div>

                <select x-model="todo.status">
                  <option>À faire</option>
                  <option>En cours</option>
                  <option>Terminé</option>
                </select>

                <button x-on:click="todo.isEditing = true">✏️</button>
                <button x-on:click="if(confirm('Voulez vous vraiment suprimer cette tâche')) deleteTodo(todo.id)">🗑️</button>
              </div>
            </template>

            <template x-if="todo.isEditing">
              <div>
                <input type="text" x-model="todo.title">
                <input type="text" x-model="todo.description">
                <button x-on:click="todo.isEditing = false">Valider</button>
                <button x-on:click="todo.isEditing = false">Annuler</button>
              </div>
            </template>
          </div>
        </template>
      </div>

      <div x-show="filtreStatus === 'Toutes' || filtreStatus === 'En cours'">
        <h2>En cours (<span x-text="filteredTodos('En cours').length"></span> tâches)</h2>
        <template x-for="todo in filteredTodos('En cours')" :key="todo.id">
          <div class="TodoInProgress">
            <template x-if="!todo.isEditing">
              <div>
                <div x-text="todo.title"></div>
                <div x-text="'Description : ' + todo.description"></div>

                <select x-model="todo.status">
                  <option>À faire</option>
                  <option>En cours</option>
                  <option>Terminé</option>
                </select>

                <button x-on:click="todo.isEditing = true">✏️</button>
                <button x-on:click="if(confirm('Voulez vous vraiment suprimer cette tâche')) deleteTodo(todo.id)">🗑️</button>
              </div>
            </template>

            <template x-if="todo.isEditing">
              <div>
                <input type="text" x-model="todo.title">
                <input type="text" x-model="todo.description">
                <button x-on:click="todo.isEditing = false">Valider</button>
                <button x-on:click="todo.isEditing = false">Annuler</button>
              </div>
            </template>
          </div>
        </template>
      </div>

      <div x-show="filtreStatus === 'Toutes' || filtreStatus === 'Terminé'">
        <h2>Terminé (<span x-text="filteredTodos('Terminé').length"></span> tâches)</h2>
        <template x-for="todo in filteredTodos('Terminé')" :key="todo.id">
          <div class="TodoDone">
            <template x-if="!todo.isEditing">
              <div>
                <div x-text="todo.title"></div>
                <div x-text="'Description : ' + todo.description"></div>

                <select x-model="todo.status">
                  <option>À faire</option>
                  <option>En cours</option>
                  <option>Terminé</option>
                </select>

                <button x-on:click="todo.isEditing = true">✏️</button>
                <button x-on:click="if(confirm('Voulez vous vraiment suprimer cette tâche')) deleteTodo(todo.id)">🗑️</button>
              </div>
            </template>

            <template x-if="todo.isEditing">
              <div>
                <input type="text" x-model="todo.title">
                <input type="text" x-model="todo.description">
                <button x-on:click="todo.isEditing = false">Valider</button>
                <button x-on:click="todo.isEditing = false">Annuler</button>
              </div>
            </template>
          </div>
        </template>
      </div>

    </div>
  </div>

  <script>
    function todoApp() {
      return {
        todos: Alpine.$persist([]),
        newTodoTitle: '',
        newTodoDesc: '',
        filtreStatus: 'Toutes',

        addNewTodo() {
          this.todos.push({
            id: Date.now(),
            title: this.newTodoTitle,
            description: this.newTodoDesc,
            isEditing: false,
            status: 'À faire'
          });

          this.newTodoTitle = '';
          this.newTodoDesc = '';
        },

        deleteTodo(todoId) {
          this.todos = this.todos.filter(todo => todo.id !== todoId);
        },

        filteredTodos(status) {
          if(this.filtreStatus === 'Toutes') {
            return this.todos.filter(t => t.status === status);
          }
          return this.todos.filter(t => t.status === this.filtreStatus && t.status === status);
        }
      }
    }
  </script>

</body>
</html>
